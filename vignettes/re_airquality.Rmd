---
title: "Ozone Concentration Analysis"
author: "Ananda Kurth"
date: "2025-03-14"
output:
  html_document:
    df_print: paged
---

## Introduction

### Dataset Description

The dataset contains measurements of daily air quality in New York between May 1973 and September 1973. It includes the following variables:

-   `Ozone`: Ozone concentration (ppb).
-   `Solar.R`: Solar radiation (langleys/day).
-   `Wind`: Wind speed (mph).
-   `Temp`: Temperature (°F).
-   `Month`: Month of the year.

### Research Question

**How does wind speed affect ozone concentration under high solar radiation conditions?**

------------------------------------------------------------------------

## Data Preparation

### Load Libraries & Set Theme

```{r setup, include=FALSE}
# Load libraries
library(knitr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(corrplot)
library(cowplot)
library(RColorBrewer)
```

### Set theme & color palettes

```{r custom-theme}
# Define custom theme for plots
custom_theme <- theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14), 
    plot.subtitle = element_text(hjust = 0.5, face = "italic", size = 10), 
    legend.position = "right"
  )

# Define color-blind friendly color palettes
qualitative_palette <- brewer.pal(8, "Set2")
diverging_palette <- brewer.pal(5, "RdBu")
```

### Clean Data & Prepare for Analysis

```{r clean-data}
# Load and clean data 
df <- datasets::airquality |>
  filter(!is.na(Ozone), !is.na(Solar.R), !is.na(Wind), !is.na(Temp)) |>
      mutate(
    Month = factor(Month, labels = c("May", "Jun", "Jul", "Aug", "Sep")))       # Categorize months# Remove missing values from the dataset

```

> Data were cleaned by removing missing values.

------------------------------------------------------------------------

## Analysis & Visualization

### Data Overview

```{r summary}
# Summarize the dataset for an overview
summary(df)
```

> Ozone levels ranged from 1 to 168 ppb, with a mean of 42 ppb. Solar radiation varied between 7 and 334 langleys per day, averaging 184 langleys. Wind speeds ranged from 1.7 to 20.7 mph, with a median of 9.7 mph. Finally, temperatures ranged from 57 to 97 °F, with a mean of 77.79 °F.

### Ozone Concentration by Month

```{r ozone-month}
# Visualize ozone concentration by month 
ggplot(df, aes(x = Month, y = Ozone, fill = Month)) +
  geom_boxplot() +
  scale_fill_manual(values = qualitative_palette) +
  custom_theme +
    theme(
    legend.position = "none"
  ) +
  labs(x = "Month", y = "Ozone (ppb)", 
       title = "Ozone Concentration by Month")
```

> Ozone concentrations reached their highest levels in July and were at their lowest in May, indicating a seasonal pattern influenced by increased summer temperatures and solar radiation.

### Correlation Analysis

```{r correlation}
# Calculate correlation matrix between ozone and meteorological variables
corr_matrix <- df |> select(Ozone, Solar.R, Wind, Temp) |> 
  cor(use = "complete.obs")
# Convert correlation matrix to a data frame for visualization
corr_df <- as.data.frame(as.table(corr_matrix))

# Visualize correlation matrix 
ggplot(corr_df, aes(Var1, Var2, fill = Freq)) + 
  geom_tile(color = "white", linewidth = 0.8) +
  geom_text(aes(label = round(Freq, 2)), color = "black", size = 6, fontface = "bold") +
  scale_fill_gradient2(low = diverging_palette[1], mid = "white", high = diverging_palette[5], midpoint = 0, limits = c(-1, 1)) + 
  labs(
    title = "Correlation Matrix of Meteorological Variables",
    subtitle = "Stronger relationships appear in darker shades",
    x = "Meteorological Variables", 
    y = "Meteorological Variables",
  ) +
  custom_theme +
  theme(
    legend.position = "none"
  )
```

> Ozone concentrations are strongly correlated with temperature (r ≈ 0.7), moderately with solar radiation (r ≈ 0.35), and negatively with wind speed (r ≈ -0.61). Wind speed also negatively correlates with temperature (r ≈ -0.50), suggesting that wind disperses ozone and cools temperatures.
>
> To further explore the relationship between wind speed and temperature concerning ozone, days were classified as "windy" if wind speeds were above the median and "low wind" if below. High solar radiation days (solar radiation \> median) were filtered to observe clearer trends, as higher solar radiation typically increases temperatures.

### Filter High Solar Radiation Days

```{r filter_data}
  df <- df |>
mutate(
    WindCondition = ifelse(Wind > median(Wind, na.rm = TRUE), "Windy", "Low Wind"),   # Categorize Windy vs. Low Wind conditions                   # Standardize Ozone concentration
  )

# Filter high solar radiation days 
df_high_solar <- df |> filter(Solar.R > median(Solar.R, na.rm = TRUE))          # Filter high solar radiation days 
df_high_solar$SolarCondition <- "High Solar Radiation"                  # Categorize high solar radiation days 
```

### Average Ozone on High Solar Radiation Days

```{r average_ozone}
# Calculate median ozone and mean wind speed for annotations
stats <- df_high_solar |> 
  group_by(WindCondition) |> 
  summarize(
    mean_ozone = mean(Ozone),
    mean_wind = mean(Wind)
  )

# Boxplot with annotations for mean wind speed under each wind condition
ggplot(df_high_solar, aes(x = WindCondition, y = Ozone, fill = WindCondition)) +
  geom_boxplot() +
  
  # Annotate mean wind below each box
  geom_text(data = stats, aes(label = paste0("Mean: ", round(mean_wind,1), " mph"), 
                              y = -10),
            color = "black", size = 3.5,) +
  geom_text(data = stats, aes(label = paste0("Mean: ", round(mean_ozone,1)), y = mean_ozone + 1), 
            color = "black", size = 3.5) +
  scale_fill_manual(values = c("Windy" = qualitative_palette[1], 
                               "Low Wind" = qualitative_palette[2])) +
  custom_theme +
  theme(legend.position = "none") +
  labs(
    x = "Wind Condition",
    y = "Ozone (ppb)",
    title = "Average Ozone Concentration on High Solar Radiation Days\n(Windy vs. Low Wind)",
  )

```

> Mean ozone levels were higher in low-wind conditions (69.6 ppb, with wind speeds around 7.1 mph) compared to windy conditions (30.9 ppb, with wind speeds around 12.6 mph). This finding supports the theory that wind has a dispersing effect on ozone. Next, the relationship between ozone levels and temperature, depending on wind conditions, was visualized in greater detail.

### Ozone vs. Temperature by Wind Condition

```{r temp_windy}
# Visualize the relationship between ozone and temperature under windy and low wind conditions
ggplot(df_high_solar, aes(x = Temp, y = Ozone, color = WindCondition)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", linewidth = 1.2, se = TRUE) +
  scale_color_manual(values = c("Windy" = qualitative_palette[1], "Low Wind" = qualitative_palette[2])) +
  custom_theme +
  labs(
    x = "Temperature (°F)",
    y = "Ozone (ppb)",
    title = "Ozone vs. Temperature\n(Windy vs. Low Wind)",
    subtitle = "Effect of wind on temperature-driven ozone accumulation"
  )
```

> Under low wind conditions, ozone levels increased by approximately 64 ppb as temperatures rose from 70°F to 90°F. However, when wind was present, this increase was limited to about 34 ppb, indicating that wind significantly reduces ozone accumulation during hot days.

## Conclusions

> The analysis examines how wind speed affects ozone concentration during high solar radiation periods. Ozone levels varied from 1 to 168 ppb, averaging 42 ppb, with peaks in July and lows in May due to seasonal factors. There is a strong positive correlation between ozone and temperature (r ≈ 0.7), a moderate correlation with solar radiation (r ≈ 0.35), and a negative correlation with wind speed (r ≈ -0.61). Ozone levels were significantly higher during low-wind conditions (69.6 ppb) compared to windy conditions (30.9 ppb). In low wind, ozone levels increased with higher temperatures, while this increase was limited in windy conditions, indicating that wind disperses ozone on warmer days. Ozone formation is more significant on hot, sunny days with minimal wind.

## Source
> Chambers, J. M., Cleveland, W. S., Kleiner, B., & Tukey, P. A. (1983). *Graphical Methods for Data Analysis*. Belmont, CA: Wadsworth.
